FROM alpine:3.21.4

RUN apk update && \
    apk add --no-cache mariadb mariadb-client

# Create MariaDB configuration to listen on all interfaces
RUN echo '[mysqld]' > /etc/my.cnf.d/mariadb-server.cnf && \
    echo 'bind-address = 0.0.0.0' >> /etc/my.cnf.d/mariadb-server.cnf && \
    echo 'port = 3306' >> /etc/my.cnf.d/mariadb-server.cnf && \
    echo 'datadir = /var/lib/mysql' >> /etc/my.cnf.d/mariadb-server.cnf && \
    echo 'socket = /run/mysqld/mysqld.sock' >> /etc/my.cnf.d/mariadb-server.cnf

RUN mkdir -p /run/mysqld && \
    chown mysql:mysql /run/mysqld

COPY ./tools/script.sh /tmp/script.sh
RUN chmod +x /tmp/script.sh

EXPOSE 3306

CMD ["sh", "/tmp/script.sh", "mariadbd-safe", "--datadir=/var/lib/mysql", "--user=mysql"]